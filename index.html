<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Confession to Nadira</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #0a001f;
      font-family: 'Comic Sans MS', Arial, sans-serif;
    }
    canvas {
      position: absolute;
      top: 0;
      left: 0;
      display: none;
      z-index: 1;
      width: 100%;
      height: 100%;
    }
    .welcome {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      z-index: 10;
      position: relative;
      text-align: center;
      padding: 10px;
    }
    .welcome h1 {
      font-size: 6vw; /* Responsive font size */
      color: #ff69b4;
      text-shadow: 1px 1px #fff;
      z-index: 10;
      margin: 0 10px;
    }
    .welcome button {
      padding: 10px 20px;
      font-size: 4vw; /* Responsive button text */
      background-color: #ff69b4;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
      transition: transform 0.2s;
      z-index: 10;
      min-width: 150px; /* Ensure button is large enough for touch */
      touch-action: manipulation; /* Improve touch responsiveness */
    }
    .welcome button:hover {
      transform: scale(1.1);
    }
    #bear {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      width: 20vw; /* Responsive bear size */
      max-width: 120px;
      z-index: 5;
      display: none;
    }
    @media (max-width: 600px) {
      .welcome h1 {
        font-size: 8vw;
      }
      .welcome button {
        font-size: 5vw;
        padding: 12px 24px;
      }
      #bear {
        width: 25vw;
      }
    }
  </style>
</head>
<body>
  <canvas id="canvas"></canvas>
  <div class="welcome" id="welcome">
    <h1>Nad!!! Ada benda nak cakap ni 🎉</h1>
    <button onclick="startReveal()">Tekan Sini!</button>
  </div>
  <img id="bear" src="https://i.pinimg.com/originals/e5/c5/4c/e5c54cd43fd75a7ec5b7cf0f65838ec3.gif" alt="Cute bear waving"/>

  <script>
    function startReveal() {
      document.getElementById("welcome").style.display = "none";
      document.getElementById("canvas").style.display = "block";
      document.getElementById("bear").style.display = "block";
      initAnimation();
    }

    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const stars = [];
    const explosions = [];
    const shootingStars = [];
    let fullText = ["Miss You Nadira Amiruddin!"];
    const fontSize = Math.min(50, window.innerWidth / 20); // Smaller font for mobile
    const fontFamily = "Arial";
    const lineHeight = fontSize * 1.2;
    let bearX = 0;
    let bearY = 0;
    let dots = [];
    let targetDotsQueue = [];
    let currentCharIndex = 0;
    let animationDone = false;

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      bearX = canvas.width / 2;
      bearY = canvas.height - Math.min(80, canvas.height * 0.15);
      stars.length = 0;
      for (let i = 0; i < 100; i++) {
        stars.push({
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height,
          radius: Math.random() * 1.5 + 0.5,
          alpha: Math.random(),
          delta: (Math.random() * 0.02) + 0.005
        });
      }
    }

    function drawStars() {
      for (let star of stars) {
        star.alpha += star.delta;
        if (star.alpha >= 1 || star.alpha <= 0) {
          star.delta = -star.delta;
        }
        ctx.save();
        ctx.globalAlpha = star.alpha;
        ctx.fillStyle = "white";
        ctx.beginPath();
        ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
        ctx.fill();
        ctx.restore();
      }
    }

    function createShootingStar() {
      const startX = Math.random() * canvas.width;
      const startY = Math.random() * canvas.height / 2;
      shootingStars.push({
        x: startX,
        y: startY,
        length: Math.random() * 150 + 50, // Smaller trails on mobile
        speed: Math.random() * 5 + 3,
        angle: Math.PI / 4,
        opacity: 1
      });
    }

    function drawShootingStars() {
      for (let i = shootingStars.length - 1; i >= 0; i--) {
        const s = shootingStars[i];
        const endX = s.x - Math.cos(s.angle) * s.length;
        const endY = s.y - Math.sin(s.angle) * s.length;
        const gradient = ctx.createLinearGradient(s.x, s.y, endX, endY);
        gradient.addColorStop(0, `rgba(255, 255, 255, ${s.opacity})`);
        gradient.addColorStop(1, `rgba(255, 255, 255, 0)`);
        ctx.strokeStyle = gradient;
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(s.x, s.y);
        ctx.lineTo(endX, endY);
        ctx.stroke();
        s.x += Math.cos(s.angle) * s.speed;
        s.y += Math.sin(s.angle) * s.speed;
        s.opacity -= 0.01;
        if (s.opacity <= 0) shootingStars.splice(i, 1);
      }
    }

    function generateCharDots(char, x, y) {
      const tempCanvas = document.createElement('canvas');
      tempCanvas.width = canvas.width;
      tempCanvas.height = canvas.height;
      const tempCtx = tempCanvas.getContext('2d');
      tempCtx.font = `bold ${fontSize}px ${fontFamily}`;
      tempCtx.fillStyle = "red";
      tempCtx.fillText(char, x, y);
      const imageData = tempCtx.getImageData(0, 0, canvas.width, canvas.height).data;
      const charDots = [];
      for (let yy = 0; yy < canvas.height; yy += 6) { // Larger step for performance
        for (let xx = 0; xx < canvas.width; xx += 6) {
          const index = (yy * canvas.width + xx) * 4;
          if (imageData[index + 3] > 128) charDots.push({ x: xx, y: yy });
        }
      }
      return charDots;
    }

    function generateAllTargetDots() {
      const tempCtx = document.createElement('canvas').getContext('2d');
      tempCtx.font = `bold ${fontSize}px ${fontFamily}`;
      const lines = fullText;
      const startY = (canvas.height - lines.length * lineHeight) / 2;
      lines.forEach((line, lineIndex) => {
        const lineWidth = tempCtx.measureText(line).width;
        let xCursor = (canvas.width - lineWidth) / 2;
        const y = startY + lineIndex * lineHeight;
        for (let char of line) {
          if (char === " ") {
            xCursor += tempCtx.measureText(" ").width;
            targetDotsQueue.push([]);
            continue;
          }
          const charDots = generateCharDots(char, xCursor, y);
          targetDotsQueue.push(charDots);
          xCursor += tempCtx.measureText(char).width;
        }
      });
    }

    function shootDot() {
      if (animationDone) return;
      while (currentCharIndex < targetDotsQueue.length && targetDotsQueue[currentCharIndex].length === 0) {
        currentCharIndex++;
      }
      const targetDots = targetDotsQueue[currentCharIndex];
      if (!targetDots) return;
      for (let i = 0; i < 3; i++) { // Fewer dots per frame on mobile
        const target = targetDots.shift();
        if (!target) return;
        const angle = Math.random() * Math.PI / 6 - Math.PI / 12;
        const speed = 2 + Math.random() * 1.5;
        dots.push({
          x: bearX + Math.random() * 10,
          y: bearY - 10 + Math.random() * 5,
          vx: Math.cos(angle) * speed,
          vy: Math.sin(angle) * speed,
          targetX: target.x,
          targetY: target.y
        });
      }
      if (targetDots.length === 0 && currentCharIndex < targetDotsQueue.length - 1) currentCharIndex++;
    }

    function createExplosion(x, y) {
      for (let i = 0; i < 10; i++) { // Fewer particles on mobile
        const angle = Math.random() * Math.PI * 2;
        const speed = Math.random() * 4 + 1;
        explosions.push({
          x, y,
          vx: Math.cos(angle) * speed,
          vy: Math.sin(angle) * speed,
          life: 40,
          opacity: 1
        });
      }
    }

    function animate() {
      const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
      gradient.addColorStop(0, "#0a001f");
      gradient.addColorStop(1, "#1a0033");
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      drawStars();
      drawShootingStars();
      dots.forEach(dot => {
        const dx = dot.targetX - dot.x;
        const dy = dot.targetY - dot.y;
        dot.vx += dx * 0.002;
        dot.vy += dy * 0.002;
        dot.vx *= 0.95;
        dot.vy *= 0.91;
        dot.x += dot.vx;
        dot.y += dot.vy;
        ctx.font = `${fontSize / 3}px Arial`; // Smaller hearts on mobile
        ctx.fillText("❤️", dot.x, dot.y);
      });
      for (let i = explosions.length - 1; i >= 0; i--) {
        const p = explosions[i];
        p.x += p.vx;
        p.y += p.vy;
        p.vx *= 0.96;
        p.vy *= 0.96;
        p.life--;
        p.opacity -= 0.015;
        ctx.globalAlpha = Math.max(p.opacity, 0);
        ctx.fillStyle = "white";
        ctx.beginPath();
        ctx.arc(p.x, p.y, 1.5, 0, Math.PI * 2);
        ctx.fill();
        ctx.globalAlpha = 1;
        if (p.life <= 0 || p.opacity <= 0) explosions.splice(i, 1);
      }
      if (!animationDone && currentCharIndex >= targetDotsQueue.length &&
          dots.every(dot => Math.abs(dot.targetX - dot.x) < 2 && Math.abs(dot.targetY - dot.y) < 2)) {
        animationDone = true;
        const bear = document.getElementById("bear");
        bear.src = "https://i.pinimg.com/originals/7e/f6/9c/7ef69cd0a6b0b78526c8ce983b3296fc.gif";
        bear.alt = "Cute bear celebrating";
        ctx.fillStyle = "#ff69b4";
        ctx.font = `${fontSize / 2}px Arial`;
        ctx.textAlign = "center";
        ctx.fillText("I ❤️ You!", canvas.width / 2, canvas.height - 30);
      }
      requestAnimationFrame(animate);
    }

    function initAnimation() {
      resizeCanvas();
      generateAllTargetDots();
      setInterval(shootDot, 50); // Slower dot shooting on mobile
      setInterval(createShootingStar, 2000);
      animate();
    }

    canvas.addEventListener("click", e => createExplosion(e.clientX, e.clientY));
    canvas.addEventListener("touchstart", e => {
      e.preventDefault();
      const touch = e.touches[0];
      createExplosion(touch.clientX, touch.clientY);
    });
    window.addEventListener("resize", resizeCanvas);
  </script>
</body>
</html>
